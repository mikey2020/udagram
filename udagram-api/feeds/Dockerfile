FROM node:13

WORKDIR /usr/src/app

COPY package*.json ./

RUN npm install

COPY . .

ENV POSTGRES_USERNAME=${POSTGRES_USERNAME}
ENV POSTGRES_PASSWORD=${POSTGRES_USERNAME}
ENV POSTGRES_HOST=${POSTGRES_HOST}
ENV POSTGRES_DB=${POSTGRES_DB}
ENV AWS_BUCKET=${AWS_BUCKET}
ENV AWS_REGION=${AWS_REGION}
ENV AWS_PROFILE=${AWS_PROFILE}
ENV JWT_SECRET=${JWT_SECRET}
ENV URL=${URL}

RUN npm run tsc

EXPOSE 8080

CMD ["node", "www/server.js"]
